# SOME DESCRIPTIVE TITLE
# Copyright (C) YEAR Free Software Foundation, Inc.
# This file is distributed under the same license as the PACKAGE package.
# FIRST AUTHOR <EMAIL@ADDRESS>, YEAR.
#
#, fuzzy
msgid ""
msgstr ""
"Project-Id-Version: PACKAGE VERSION\n"
"POT-Creation-Date: 2012-11-14 06:02+0900\n"
"PO-Revision-Date: YEAR-MO-DA HO:MI+ZONE\n"
"Last-Translator: FULL NAME <EMAIL@ADDRESS>\n"
"Language-Team: LANGUAGE <LL@li.org>\n"
"Language: \n"
"MIME-Version: 1.0\n"
"Content-Type: text/plain; charset=UTF-8\n"
"Content-Transfer-Encoding: 8bit\n"

#. type: Content of: <guide><title>
#: en/mailfilter-guide.xml:6
#, no-wrap
msgid "Gentoo mailfiltering gateway guide"
msgstr ""

#. type: Content of: <guide><abstract>
#: en/mailfilter-guide.xml:19
#, no-wrap
msgid ""
"This guide is step-by-step guide for installing spam fighting technologies for\n"
"Postfix. Among them Amavisd-new using Spamassassin and ClamAV, greylisting and\n"
"SPF.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><title>
#: en/mailfilter-guide.xml:32 en/mailfilter-guide.xml:1186
#: en/mailfilter-guide.xml:1411
#, no-wrap
msgid "Introduction"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:37
#, no-wrap
msgid ""
"This guide describe step by step how to install a spam and virus filtering mail\n"
"gateway. It is quite simple to adopt this to a single server solution.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><title>
#: en/mailfilter-guide.xml:44
#, no-wrap
msgid "The big picture"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:48
#, no-wrap
msgid ""
"This document describe how to setup a spam filtering mail gateway with\n"
"multiple domains. This server is meant to run in front of the mail\n"
"servers actually keeping the mail accounts i.e. Microsoft Exchange or\n"
"Lotus Notes.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:55
#, no-wrap
msgid ""
"In this setup applications with good security records and readable\n"
"configuration files have been chosen. The email MTA is postfix which\n"
"has a good security record and is fairly easy to setup right.\n"
"Postfix will listen normally on port 25 for incoming mail. Upon reception it\n"
"will forward it to Amavisd-new on port 10024. Amavisd-new will then filter\n"
"the mail through different filters before passing the mail back to Postfix\n"
"on port 10025 which in turn will forward the mail to the next mail server.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:65
#, no-wrap
msgid ""
"Amavisd-new is a content filtering framework utilizing helper applications for\n"
"virus filtering and spam filtering. In this setup we will be using two helper\n"
"applications one ClamAV for filtering virus mails and Spamassassin for filtering\n"
"spam. Spamassassin itself can function as yet another layer of content filtering\n"
"framework and utilize the helper applications Vipul's Razor2 and DCC.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:73
#, no-wrap
msgid ""
"Unlike many other spam fighting technologies like RBLs and others Spamassassin\n"
"does not simply accept or reject a given email based on one single test. It uses\n"
"a lot of internal tests and external helper applications to calculate a spam\n"
"score for every mail passed through. This score is based on the following tests:\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><ul><li>
#: en/mailfilter-guide.xml:80
#, no-wrap
msgid "Bayesian filtering"
msgstr ""

#. type: Content of: <guide><chapter><section><body><ul><li>
#: en/mailfilter-guide.xml:81
#, no-wrap
msgid "Static rules based on regular expressions"
msgstr ""

#. type: Content of: <guide><chapter><section><body><ul><li>
#: en/mailfilter-guide.xml:82
#, no-wrap
msgid ""
"Distributed and collaborative networks:\n"
"  "
msgstr ""

#. type: Content of: <guide><chapter><section><body><ul><li><ul><li>
#: en/mailfilter-guide.xml:84
#, no-wrap
msgid "RBLs"
msgstr ""

#. type: Content of: <guide><chapter><section><body><ul><li><ul><li>
#: en/mailfilter-guide.xml:85
#, no-wrap
msgid "Razor2"
msgstr ""

#. type: Content of: <guide><chapter><section><body><ul><li><ul><li>
#: en/mailfilter-guide.xml:86
#, no-wrap
msgid "Pyzor"
msgstr ""

#. type: Content of: <guide><chapter><section><body><table><tr><ti>
#: en/mailfilter-guide.xml:87 en/mailfilter-guide.xml:235
#, no-wrap
msgid "DCC"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:93
#, no-wrap
msgid ""
"The first part (chapters 1 to 4) of the guide will describe the basic setup\n"
"of a mailfiltering gateway. The next chapters can be implemented individually\n"
"with no dependence between each chapter. These chapters describe how to:\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><ul><li>
#: en/mailfilter-guide.xml:100
#, no-wrap
msgid ""
"    setup special IMAP folders for learning of the Bayesian\n"
"    filter and for delivery of false positives\n"
"  "
msgstr ""

#. type: Content of: <guide><chapter><section><body><ul><li>
#: en/mailfilter-guide.xml:106
#, no-wrap
msgid "setup greylisting with Postfix"
msgstr ""

#. type: Content of: <guide><chapter><section><body><ul><li>
#: en/mailfilter-guide.xml:107
#, no-wrap
msgid "setup Amavisd-new to use a MySQL backend for user preferences"
msgstr ""

#. type: Content of: <guide><chapter><section><body><ul><li>
#: en/mailfilter-guide.xml:108
#, no-wrap
msgid "setup Spamassassin to use a MySQL backend for AWL and Bayes data"
msgstr ""

#. type: Content of: <guide><chapter><section><body><note>
#: en/mailfilter-guide.xml:112
#, no-wrap
msgid ""
"The IMAP folders will be using the maildir format. Having each mail in a\n"
"separate file makes handling much simpler. If you're using mbox I propose to\n"
"give maildir a try. If you're not already using maildir emerge the necessary\n"
"tools with <c>emerge courier-imap</c>.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:119
#, no-wrap
msgid ""
"A planned fifth part will contain various tips regarding performance and things\n"
"you may want to know (running chrooted, postfix restrictions, etc.).\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><note>
#: en/mailfilter-guide.xml:124
#, no-wrap
msgid ""
"Delegating responsibility to third parties is not without risks. You have to\n"
"know and trust these third parties. In this setup only the decision to\n"
"quarantine virus mails are based on a single third party. Using Spamassassin's\n"
"scoring system the decision to stop spam mails are not made by a single\n"
"authority except perhaps Spamassassins own static rules.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><warn>
#: en/mailfilter-guide.xml:132
#, no-wrap
msgid ""
"When rejecting spam mails at the MTA level you have to be very careful when\n"
"selecting the RBL's you want to use, i.e. SpamCop is a bad RBL to use at the MTA\n"
"level because you will experience false positives because sometimes their\n"
"listing is just too aggressive. Further info at <uri\n"
"link=\"http://www.geekcomix.com/cgi-bin/classnotes/wiki.pl?UNIX03/Realtime_Blackhole_Lists_Are_Bad\">Realtime\n"
"Blackhole Lists Are Bad</uri> and <uri\n"
"link=\"http://theory.whirlycott.com/~phil/antispam/rbl-bad/rbl-bad.html\">The Spam\n"
"Problem: Moving Beyond RBLs</uri>\n"
msgstr ""

#. type: Content of: <guide><chapter><section><title>
#: en/mailfilter-guide.xml:145 en/mailfilter-guide.xml:1462
#, no-wrap
msgid "Preparations"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:149
#, no-wrap
msgid ""
"Before you start make sure that you have a working Postfix installation where\n"
"you can send and receive mails also you need a backend mailserver. If you're not\n"
"experienced with setting up Postfix it might quickly become too complicated if\n"
"all should be set up at once. If you need help you can find it in the excellent\n"
"<uri link=\"http://www.gentoo.org/doc/en/virt-mail-howto.xml\">Virtual\n"
"Mailhosting System with Postfix Guide</uri> in the Gentoo Documentation.\n"
msgstr ""

#. type: Content of: <guide><chapter><title>
#: en/mailfilter-guide.xml:162
#, no-wrap
msgid "Installing the programs needed"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:167
#, no-wrap
msgid ""
"We start out by installing the most important programs: Amavisd-new,\n"
"Spamassassin and ClamAV.\n"
msgstr ""

#. type: Attribute 'caption' of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:171
#, no-wrap
msgid "Installing Amavis, Spamassassin and Clamav"
msgstr ""

#. type: Content of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:172
#, no-wrap
msgid "# <i>emerge amavisd-new spamassassin clamav </i>\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><note>
#: en/mailfilter-guide.xml:176
#, no-wrap
msgid ""
"As previously mentioned you should already have a working <c>postfix</c>\n"
"instance running on the box. Basically this shouldn't be much more than\n"
"<c>emerge postfix</c> <e>and</e> have a basic understanding of how Postfix is\n"
"working.\n"
msgstr ""

#. type: Attribute 'caption' of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:185 en/mailfilter-guide.xml:203
#, no-wrap
msgid "Setting up DNS"
msgstr ""

#. type: Content of: <guide><chapter><section><body><note>
#: en/mailfilter-guide.xml:189
#, no-wrap
msgid ""
"If you're not setting up a gateway server but have the mailboxes on\n"
"the same server you only have to create the MX-Record.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:194
#, no-wrap
msgid ""
"While the programs are emerging fire up another shell and create the needed DNS\n"
"records.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:199
#, no-wrap
msgid ""
"Start out by creating a <c>MX</c> record for the mail gateway and an <c>A</c>\n"
"record for the next destination.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:204
#, no-wrap
msgid ""
"<comment>(Create a MX record for the gateway server)</comment>\n"
"                MX      10      mailgateway.mydomain.tld.\n"
"<comment>(Create an A record for the gateway server)</comment>\n"
"mailgateway     A       mgw.ip.add.here\n"
"<comment>(Create an A record for the next hop mail server)</comment>\n"
"mail            A       ms.ip.add.here\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><note>
#: en/mailfilter-guide.xml:213
#, no-wrap
msgid ""
"Some ADSL providers might block port 25 and force you to relay mail through one\n"
"of their servers. Typically you have to create a secondary MX-Record\n"
"like <c>MX      20      backup-mx.some-isp.tld</c>\n"
msgstr ""

#. type: Content of: <guide><chapter><section><title>
#: en/mailfilter-guide.xml:221
#, no-wrap
msgid "Opening the firewall"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:225
#, no-wrap
msgid ""
"In addition to allowing normal mail traffic you have to allow a\n"
"few services through your firewall to allow the network checks to\n"
"communicate with the servers.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><table><tr><th>
#: en/mailfilter-guide.xml:232
#, no-wrap
msgid "Application"
msgstr ""

#. type: Content of: <guide><chapter><section><body><table><tr><th>
#: en/mailfilter-guide.xml:232
#, no-wrap
msgid "Protocol"
msgstr ""

#. type: Content of: <guide><chapter><section><body><table><tr><th>
#: en/mailfilter-guide.xml:232
#, no-wrap
msgid "Port"
msgstr ""

#. type: Content of: <guide><chapter><section><body><table><tr><ti>
#: en/mailfilter-guide.xml:235
#, no-wrap
msgid "UDP"
msgstr ""

#. type: Content of: <guide><chapter><section><body><table><tr><ti>
#: en/mailfilter-guide.xml:235
#, no-wrap
msgid "6277"
msgstr ""

#. type: Content of: <guide><chapter><section><body><table><tr><ti>
#: en/mailfilter-guide.xml:238
#, no-wrap
msgid "Razor(outgoing ping)"
msgstr ""

#. type: Content of: <guide><chapter><section><body><table><tr><ti>
#: en/mailfilter-guide.xml:238 en/mailfilter-guide.xml:241
#, no-wrap
msgid "TCP"
msgstr ""

#. type: Content of: <guide><chapter><section><body><table><tr><ti>
#: en/mailfilter-guide.xml:238
#, no-wrap
msgid "7"
msgstr ""

#. type: Content of: <guide><chapter><section><body><table><tr><ti>
#: en/mailfilter-guide.xml:241
#, no-wrap
msgid "Razor"
msgstr ""

#. type: Content of: <guide><chapter><section><body><table><tr><ti>
#: en/mailfilter-guide.xml:241
#, no-wrap
msgid "2703"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:246
#, no-wrap
msgid "Razor uses pings to discover what servers are closest to it.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><title>
#: en/mailfilter-guide.xml:252
#, no-wrap
msgid "Configuring Postfix"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:256
#, no-wrap
msgid ""
"First we have to tell <c>postfix</c> to listen on port 10025 and we remove most\n"
"of the restrictions as they have already been applied by the <c>postfix</c>\n"
"instance listening on port 25. Also we ensure that it will only listen for local\n"
"connections on port 10025.  To accomplish this we have to add the following at\n"
"the end of <path>/etc/postfix/master.cf</path>\n"
msgstr ""

#. type: Attribute 'caption' of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:263
#, no-wrap
msgid "Changing the master.cf file"
msgstr ""

#. type: Content of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:264
#, no-wrap
msgid ""
"smtp-amavis     unix -        -       n     -       2  smtp\n"
"  -o smtp_data_done_timeout=1200\n"
"  -o smtp_send_xforward_command=yes\n"
"<comment>#Equivalently when using lmtp:\n"
"#lmtp-amavis    unix -        -       n     -       2  lmtp\n"
"#   -o lmtp_data_done_timeout=1200\n"
"#   -o lmtp_send_xforward_command=yes</comment>\n"
"\n"
"127.0.0.1:10025 inet n        -       n     -       -  smtpd\n"
"  -o content_filter=\n"
"  -o local_recipient_maps=\n"
"  -o relay_recipient_maps=\n"
"  -o smtpd_restriction_classes=\n"
"  -o smtpd_client_restrictions=\n"
"  -o smtpd_helo_restrictions=\n"
"  -o smtpd_sender_restrictions=\n"
"  -o smtpd_recipient_restrictions=permit_mynetworks,reject\n"
"  -o mynetworks=127.0.0.0/8\n"
"  -o strict_rfc821_envelopes=yes\n"
"  -o smtpd_error_sleep_time=0\n"
"  -o smtpd_soft_error_limit=1001\n"
"  -o smtpd_hard_error_limit=1000\n"
"\n"
"<comment>#If you want to use proxy filtering instead\n"
"#smtp            inet n         -       n      -       8 smtpd\n"
"# -o smtpd_proxy_filter=127.0.0.1:10024\n"
"# -o smtpd_client_connection_count_limit=4\n"
"#If you don't want to scan outgoing mail use this\n"
"#10.0.0.2:smtp   inet n         -       n       -      - smtpd\n"
"#-o content_filter=</comment>\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><note>
#: en/mailfilter-guide.xml:297
#, no-wrap
msgid ""
"The <c>smtp-amavis</c> line specifies that a maximum of two of these processes\n"
"may run at any time. If you need a greater degree of concurrency tune this\n"
"number to fit your needs. Remember that to match the number with\n"
"<c>$max_servers</c> in <path>amavisd.conf</path>. Keep in mind that\n"
"<c>amavisd-new</c> is quite memory-intensive and raising the amount of\n"
"<c>amavisd-new</c> processes too high can easily lead to memory starvation and\n"
"heavy swapping, which leads to drastically reduced performance.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><note>
#: en/mailfilter-guide.xml:307
#, no-wrap
msgid ""
"If you want to reject spam early on in the process you can use the\n"
"Before-Queue (proxy) method instead of the filter method. If you uncomment\n"
"the three lines you will have to set <c>content_filter=</c> in\n"
"<path>main.cf</path>. This is not recommended for high traffic servers\n"
"as the number of concurrent connections are limited to the number of\n"
"amavisd instances.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><warn>
#: en/mailfilter-guide.xml:316
#, no-wrap
msgid "The Before-Queue(proxy) method is still not properly tested.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><note>
#: en/mailfilter-guide.xml:320
#, no-wrap
msgid ""
"If you, for any reason whatsoever, want to send mail from this box and don't\n"
"want it scanned, add another postfix instance by uncommenting the last two\n"
"lines and substitute with a proper IP.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:326
#, no-wrap
msgid ""
"The file <path>master.cf</path> tells the postfix master program how\n"
"to run each individual postfix process. More info with <c>man 8\n"
"master</c>.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:332
#, no-wrap
msgid ""
"Next we need the main <c>postfix</c> instance listening on port 25 to filter the\n"
"mail through <c>amavisd-new</c> listening on port 10024.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:337
#, no-wrap
msgid ""
"We also need to set the next hop destination for mail. Tell Postfix to filter\n"
"all mail through an external content filter and enable explicit routing to let\n"
"Postfix know where to forward the mail to.\n"
msgstr ""

#. type: Attribute 'caption' of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:342 en/mailfilter-guide.xml:984
#, no-wrap
msgid "Modifying /etc/postfix/main.cf"
msgstr ""

#. type: Content of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:343
#, no-wrap
msgid ""
"biff = no\n"
"empty_address_recipient = MAILER-DAEMON\n"
"queue_minfree = 120000000\n"
"\n"
"content_filter = smtp-amavis:[127.0.0.1]:10024\n"
"<comment>#Equivalently when using lmtp:\n"
"#content_filter = lmtp-amavis:[127.0.0.1]:10024\n"
"\n"
"# TRANSPORT MAP\n"
"#\n"
"# Insert text from sample-transport.cf if you need explicit routing.</comment>\n"
"transport_maps = hash:/etc/postfix/transport\n"
"\n"
"relay_domains = $transport_maps\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:360
#, no-wrap
msgid ""
"Postfix has a lot of options set in <path>main.cf</path>. For further\n"
"explanation of the file please consult <c>man 5 postconf</c> or the\n"
"same online <uri link=\"http://www.postfix.org/postconf.5.html\">Postfix\n"
"Configuration Parameters</uri>.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:367
#, no-wrap
msgid ""
"The format of the <path>transport</path> file is the normal Postfix hash file.\n"
"Mail to the domain on the left hand side is forwarded to the destination on the\n"
"right hand side.\n"
msgstr ""

#. type: Attribute 'caption' of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:372
#, no-wrap
msgid "/etc/postfix/transport"
msgstr ""

#. type: Content of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:373
#, no-wrap
msgid "mydomain.tld                          smtp:mail.mydomain.tld\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:377
#, no-wrap
msgid ""
"After we have edited the file we need to run the <c>postmap</c> command. Postfix\n"
"does not actually read this file so we have to convert it to the proper format\n"
"with <c>postmap /etc/postfix/transport</c>. This creates the file\n"
"<path>/etc/postfix/transport.db</path>. There is no need to reload Postfix as it\n"
"will automatically pick up the changes.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><note>
#: en/mailfilter-guide.xml:385
#, no-wrap
msgid ""
"If the next hop mail server is not listening on the standard SMTP port 25 you\n"
"can tell postfix to use a given port number, like\n"
"<c>smtp:mail.mydomain.tld:25000</c>.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:391
#, no-wrap
msgid ""
"If your first attempts to send mail result in messages bouncing, you've likely\n"
"made a configuration error somewhere. Try temporarily enabling\n"
"<c>soft_bounce</c> while you work out your configuration issues. This prevents\n"
"postfix from bouncing mails on delivery errors by treating them as temporary\n"
"errors. It keeps mails in the mail queue until <c>soft_bounce</c> is disabled or\n"
"removed.\n"
msgstr ""

#. type: Attribute 'caption' of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:399
#, no-wrap
msgid "Enabling soft_bounce"
msgstr ""

#. type: Content of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:400
#, no-wrap
msgid ""
"# <i>postconf -e \"soft_bounce = yes\"</i>\n"
"# <i>/etc/init.d/postfix reload</i>\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:405
#, no-wrap
msgid ""
"Once you've finished creating a working configuration, be sure to disable\n"
"or remove <c>soft_bounce</c> and reload postfix.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><title>
#: en/mailfilter-guide.xml:412
#, no-wrap
msgid "Configuring Amavisd-new"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:416
#, no-wrap
msgid ""
"Amavisd-new is used to handle all the filtering and allows you to easily glue\n"
"together severel different technologies. Upon reception of a mail message it\n"
"will extract the mail, filter it through some custom filters, handle white and\n"
"black listing, filter the mail through various virus scanners and finally it\n"
"will filter the mail using SpamAssassin.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:424
#, no-wrap
msgid "Amavisd-new itself has a number of extra features:\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><ul><li>
#: en/mailfilter-guide.xml:429
#, no-wrap
msgid ""
"    it identifies dangerous file attachments and has policies to handle them\n"
"  "
msgstr ""

#. type: Content of: <guide><chapter><section><body><ul><li>
#: en/mailfilter-guide.xml:432
#, no-wrap
msgid ""
"    per-user, per-domain and system-wide policies for:\n"
"    "
msgstr ""

#. type: Content of: <guide><chapter><section><body><ul><li><ul><li>
#: en/mailfilter-guide.xml:434
#, no-wrap
msgid "whitelists"
msgstr ""

#. type: Content of: <guide><chapter><section><body><ul><li><ul><li>
#: en/mailfilter-guide.xml:435
#, no-wrap
msgid "blacklists"
msgstr ""

#. type: Content of: <guide><chapter><section><body><ul><li><ul><li>
#: en/mailfilter-guide.xml:436
#, no-wrap
msgid "spam score thresholds"
msgstr ""

#. type: Content of: <guide><chapter><section><body><ul><li><ul><li>
#: en/mailfilter-guide.xml:437
#, no-wrap
msgid "virus and spam policies"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:443
#, no-wrap
msgid ""
"Apart from <c>postfix</c> and <c>freshclam</c> we will run all applications as\n"
"the user <c>amavis</c>.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:466
#, no-wrap
msgid "Edit the following lines in <path>/etc/amavisd.conf</path>\n"
msgstr ""

#. type: Attribute 'caption' of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:469
#, no-wrap
msgid "Editing /etc/amavisd.conf"
msgstr ""

#. type: Content of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:470
#, no-wrap
msgid ""
"<comment>(Insert the domains to be scanned)</comment>\n"
"$mydomain = 'example.com';\n"
"<comment>(Bind only to loopback interface)</comment>\n"
"$inet_socket_bind = '127.0.0.1';\n"
"<comment>(Forward to Postfix on port 10025)</comment>\n"
"$forward_method = 'smtp:127.0.0.1:10025';\n"
"$notify_method = $forward_method;\n"
"<comment>(Define the account to send virus alert emails)</comment>\n"
"$virus_admin = \"virusalert\\@$mydomain\";\n"
"<comment>(Always add spam headers)</comment>\n"
"$sa_tag_level_deflt  = -100;\n"
"<comment>(Add spam detected header aka X-Spam-Status: Yes)</comment>\n"
"$sa_tag2_level_deflt = 5;\n"
"<comment>(Trigger evasive action at this spam level)</comment>\n"
"$sa_kill_level_deflt = $sa_tag2_level_deflt;\n"
"<comment>(Do not send delivery status notification to sender.  It does not affect\n"
"delivery of spam to recipient. To do that, use the kill_level)</comment>\n"
"$sa_dsn_cutoff_level = 10;\n"
"<comment>Don't bounce messages left and right, quarantine\n"
"instead</comment>\n"
"$final_virus_destiny      = D_DISCARD;  # (defaults to D_DISCARD)\n"
"$final_banned_destiny     = D_DISCARD;  # (defaults to D_BOUNCE)\n"
"$final_spam_destiny       = D_DISCARD;  # (defaults to D_BOUNCE)\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><note>
#: en/mailfilter-guide.xml:496
#, no-wrap
msgid ""
"With this line <c>$sa_tag2_level_deflt = 5;</c> you set the Spamassassin spam\n"
"score to 5. This might be a bit low. As you might have noticed the Amavisd-new\n"
"default is <c>6.3</c>. If you don't want to see a single spam mail in your\n"
"mail folder choose <c>5</c>, but if you don't want to deal with false positives\n"
"choose <c>6.3</c>.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:504
#, no-wrap
msgid ""
"Create a quarantine directory for the virus mails as we don't want these\n"
"delivered to our users.\n"
msgstr ""

#. type: Attribute 'caption' of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:508
#, no-wrap
msgid "Create a quarantine directory for the virus mails"
msgstr ""

#. type: Content of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:509
#, no-wrap
msgid ""
"# <i>mkdir /var/amavis/virusmails</i>\n"
"# <i>chown amavis:amavis /var/amavis/virusmails</i>\n"
"# <i>chmod 750 /var/amavis/virusmails</i>\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><note>
#: en/mailfilter-guide.xml:515
#, no-wrap
msgid "Amavisd-new offers finer policy tuning by using policy banks.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><title>
#: en/mailfilter-guide.xml:521
#, no-wrap
msgid "Configuring ClamAV"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:525
#, no-wrap
msgid ""
"As virus scanner we use ClamAV as it has a fine detection rate comparable with\n"
"commercial offerings, it is very fast and it is Open Source Software.  We love\n"
"log files, so make <c>clamd</c> log using <c>syslog</c> and turn on\n"
"verbose logging. Also do not run <c>clamd</c> as <c>root</c>.  Now edit\n"
"<path>/etc/clamd.conf</path>\n"
msgstr ""

#. type: Attribute 'caption' of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:532
#, no-wrap
msgid "Edit /etc/clamd.conf"
msgstr ""

#. type: Content of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:533
#, no-wrap
msgid ""
"<comment>(Verbose logging with syslog)</comment>\n"
"LogSyslog\n"
"LogVerbose\n"
"LogFacility LOG_MAIL\n"
"<comment>(Change pid file location)</comment>\n"
"PidFile /var/run/amavis/clamd.pid\n"
"<comment>(Set the clamav socket)</comment>\n"
"LocalSocket /var/amavis/clamd\n"
"<comment>(Close the connection when this limit is exceeded)</comment>\n"
"StreamMaxLength 10M\n"
"<comment>(Don't run clamd as root)</comment>\n"
"User amavis\n"
"<comment>(Newer versions require you to uncomment this)</comment>\n"
"ScanMail\n"
"ScanArchive\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><note>
#: en/mailfilter-guide.xml:551
#, no-wrap
msgid "Also remember to remove the Example directive to make ClamAV work\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:555
#, no-wrap
msgid ""
"ClamAV comes with the <c>freshclam</c> deamon dedicated to periodical checks\n"
"of virus signature updates.  Instead of updating virus signatures twice a day\n"
"we will make <c>freshclam</c> update virus signatures every two hours.\n"
msgstr ""

#. type: Attribute 'caption' of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:560
#, no-wrap
msgid "Edit /etc/freshclam.conf"
msgstr ""

#. type: Content of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:561
#, no-wrap
msgid ""
"<comment>(Syslog logging)</comment>\n"
"LogSyslog\n"
"<comment>(Verbose logging)</comment>\n"
"LogVerbose\n"
"<comment>(Explicitly drop root privileges)</comment>\n"
"DatabaseOwner clamav\n"
"<comment>(Check for updates every two hours. That is the official recommendation)</comment>\n"
"Checks 12\n"
"<comment>(Use the mirror closest to you. Replace XY with your country code</comment>\n"
"DatabaseMirror db.XY.clamav.net\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:574
#, no-wrap
msgid ""
"Start <c>clamd</c> with <c>freshclam</c> using the init scripts by modifying\n"
"<path>/etc/conf.d/clamd</path>.\n"
msgstr ""

#. type: Attribute 'caption' of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:578
#, no-wrap
msgid "Modifying /etc/conf.d/clamd"
msgstr ""

#. type: Content of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:579
#, no-wrap
msgid ""
"START_CLAMD=yes\n"
"FRESHCLAM_OPTS=\"-d\"\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:584
#, no-wrap
msgid ""
"At last modify <path>amavisd.conf</path> with the new location of the\n"
"socket.\n"
msgstr ""

#. type: Attribute 'caption' of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:588 en/mailfilter-guide.xml:1086
#, no-wrap
msgid "Modifying /etc/amavisd.conf"
msgstr ""

#. type: Content of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:589
#, no-wrap
msgid ""
"<comment>(Uncomment the clamav scanner and modify socket location)</comment>\n"
"['ClamAV-clamd',\n"
"\\&amp;ask_daemon, [\"CONTSCAN {}\\n\", \"/var/amavis/clamd\"],\n"
"  qr/\\bOK$/, qr/\\bFOUND$/,\n"
"  qr/^.*?: (?!Infected Archive)(.*) FOUND$/ ],\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><warn>
#: en/mailfilter-guide.xml:597
#, no-wrap
msgid "Do NOT modify the <c>$unix_socketname</c> unless you know what you're doing.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><title>
#: en/mailfilter-guide.xml:603
#, no-wrap
msgid "Configuring Vipul's Razor"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:607
#, no-wrap
msgid ""
"Razor2 is a collaborative and distributed spam checksum network. Install it\n"
"with <c>emerge razor</c> and create the needed configuration files. Do this\n"
"as user <c>amavis</c> by running <c>su - amavis</c> followed <c>razor-admin\n"
"-create</c>.\n"
msgstr ""

#. type: Attribute 'caption' of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:613
#, no-wrap
msgid "Creating the required configuration files"
msgstr ""

#. type: Content of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:614
#, no-wrap
msgid ""
"# <i>emerge razor</i>\n"
"\n"
"<comment>(Temporarily set amavis' shell to bash)</comment>\n"
"# <i>usermod -s /bin/bash amavis</i>\n"
"# <i>su - amavis</i>\n"
"$ <i>razor-admin -create</i>\n"
"$ <i>exit</i>\n"
"\n"
"<comment>(Reset the shell to /bin/false)</comment>\n"
"# <i>usermod -s /bin/false amavis</i>\n"
msgstr ""

#. type: Content of: <guide><chapter><section><title>
#: en/mailfilter-guide.xml:629
#, no-wrap
msgid "Configuring Distributed Checksum Clearinghouse (dcc)"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:633
#, no-wrap
msgid ""
"Like Razor2, dcc is a collaborative and distributed spam checksum network. Its\n"
"philosopy is to count the number of recipients of a given mail identifying each\n"
"mail with a fuzzy checksum.\n"
msgstr ""

#. type: Attribute 'caption' of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:638
#, no-wrap
msgid "Installing DCC"
msgstr ""

#. type: Content of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:639
#, no-wrap
msgid "# <i>emerge dcc</i>\n"
msgstr ""

#. type: Content of: <guide><chapter><section><title>
#: en/mailfilter-guide.xml:645
#, no-wrap
msgid "Configuring Spamassassin"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:649
#, no-wrap
msgid ""
"Amavis is using the Spamassassin Perl libraries directly so there is no need to\n"
"start the service. Also this creates some confusion about the configuration as\n"
"some Spamassassin settings are configured in\n"
"<path>/etc/mail/spamassassin/local.cf</path> and overridden by options in\n"
"<path>/etc/amavisd.conf</path>.\n"
msgstr ""

#. type: Attribute 'caption' of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:656
#, no-wrap
msgid "Create /etc/mail/spamassassin/local.cf"
msgstr ""

#. type: Content of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:657
#, no-wrap
msgid ""
"<comment># Enable the Bayes system</comment>\n"
"use_bayes               1\n"
"\n"
"<comment># Enable all network checks</comment>\n"
"skip_rbl_checks         0\n"
"\n"
"<comment># Mail using languages used in these country codes will not be marked\n"
"# as being possibly spam in a foreign language.\n"
"# - danish english norwegian swedish</comment>\n"
"ok_languages            da en no sv\n"
"\n"
"<comment># Mail using locales used in these country codes will not be marked\n"
"# as being possibly spam in a foreign language.</comment>\n"
"ok_locales              en\n"
"\n"
"<comment># Use a sensible bayes path</comment>\n"
"bayes_path              /var/amavis/.spamassassin/bayes\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><note>
#: en/mailfilter-guide.xml:677
#, no-wrap
msgid ""
"With Spamassassin version 3.1 you have to enable DCC, Razor2 by uncommenting\n"
"the corresponding lines in <path>v310.pre</path>.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><note>
#: en/mailfilter-guide.xml:682
#, no-wrap
msgid ""
"You can find inspiration for your <path>local.cf</path> file by trying the <uri\n"
"link=\"http://www.yrex.com/spam/spamconfig.php\">SpamAssassin Configuration\n"
"Generator</uri>.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><note>
#: en/mailfilter-guide.xml:688
#, no-wrap
msgid "You might also want to switch the <c>ok_languages</c> and <c>ok_locales</c>.\n"
msgstr ""

#. type: Content of: <guide><chapter><title>
#: en/mailfilter-guide.xml:696
#, no-wrap
msgid "Every good rule has good exceptions as well"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:701
#, no-wrap
msgid ""
"Once mail really starts passing through this mail gateway you will probably\n"
"discover that the above setup is not perfect. Maybe some of your customers like\n"
"to receive mails that others wouldn't. You can whitelist/blacklist\n"
"envelope senders quite easily. Uncomment the following line in\n"
"<path>amavisd.conf</path>.\n"
msgstr ""

#. type: Attribute 'caption' of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:708
#, no-wrap
msgid "Modifying amavisd.conf to do sitewide scoring"
msgstr ""

#. type: Content of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:709
#, no-wrap
msgid "read_hash(\"/var/amavis/sender_scores_sitewide\"),\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:713
#, no-wrap
msgid ""
"In the <path>sender_scores_sitewide</path> file you put complete email\n"
"addresses or just the domian parts and then note a positive/negative score\n"
"to add to the spam score.\n"
msgstr ""

#. type: Attribute 'caption' of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:718
#, no-wrap
msgid "whitelist_sender example"
msgstr ""

#. type: Content of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:719
#, no-wrap
msgid ""
"<comment>(Whitelist all emails from the specific email address)</comment>\n"
"postmaster@example.net                -3.0\n"
"<comment>(Whitelist all emails from the example.net excluding subdomains)</comment>\n"
".example.net                          1.0\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><note>
#: en/mailfilter-guide.xml:726
#, no-wrap
msgid "See <path>/etc/amavisd.conf</path> for more examples.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><note>
#: en/mailfilter-guide.xml:730
#, no-wrap
msgid ""
"Placing these addresses outside <path>amavisd.conf</path> is a cleaner and safer\n"
"solution.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><note>
#: en/mailfilter-guide.xml:735
#, no-wrap
msgid ""
"Alternatively it can be done in Spamassassin's configuration file\n"
"<path>/etc/mail/spamassassin/local.cf</path> but I think it is cleaner\n"
"to do it in <path>/etc/amavisd.conf</path>.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><note>
#: en/mailfilter-guide.xml:741
#, no-wrap
msgid ""
"In a later chapter I will show how to implement per-user policies using\n"
"MySQL.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:746
#, no-wrap
msgid ""
"While waiting for a better method you can add the following to\n"
"<path>amavisd.conf</path> to bypass spam checks for <c>postmaster</c> and\n"
"<c>abuse</c> mailboxes.\n"
msgstr ""

#. type: Attribute 'caption' of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:751
#, no-wrap
msgid "By pass spam filters for all postmaster and abuse mails"
msgstr ""

#. type: Content of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:752
#, no-wrap
msgid ""
"map { $bypass_spam_checks{lc($_)}=1 } (qw(\n"
"        postmaster@\n"
"        abuse@\n"
"));\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><impo>
#: en/mailfilter-guide.xml:759
#, no-wrap
msgid ""
"While we are at it we should <e>never</e> automatically discard mails to the\n"
"<c>postmaster</c> or the <c>abuse</c> accounts. See <uri\n"
"link=\"http://www.ietf.org/rfc/rfc2142.txt\">RFC 2142 MAILBOX NAMES FOR COMMON\n"
"SERVICES, ROLES AND FUNCTIONS</uri>. Otherwise your domains might end up listed\n"
"in some of the evil lists over at <uri\n"
"link=\"http://www.rfc-ignorant.org/\">rfc-ignorant.org</uri>.\n"
msgstr ""

#. type: Content of: <guide><chapter><title>
#: en/mailfilter-guide.xml:772
#, no-wrap
msgid "Adding more rules"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:777
#, no-wrap
msgid ""
"If you want to use more rules provided by the SARE Ninjas over at the\n"
"<uri link=\"http://www.rulesemporium.com/\">SpamAssassin Rules\n"
"Emporium</uri> you can easily add and update them using\n"
"the <c>sa-update</c> mechanism included in Spamassassin.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:784
#, no-wrap
msgid ""
"A brief guide to using SARE rulesets with <c>sa-update</c> can be found <uri\n"
"link=\"http://daryl.dostech.ca/sa-update/sare/sare-sa-update-howto.txt\">here</uri>.\n"
msgstr ""

#. type: Content of: <guide><chapter><title>
#: en/mailfilter-guide.xml:793
#, no-wrap
msgid "Testing and finishing up"
msgstr ""

#. type: Content of: <guide><chapter><section><title>
#: en/mailfilter-guide.xml:795
#, no-wrap
msgid "Testing the setup"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:799
#, no-wrap
msgid "Now before you start <c>freshclam</c> you can manually verify that it works.\n"
msgstr ""

#. type: Attribute 'caption' of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:802
#, no-wrap
msgid "Testing freshclam"
msgstr ""

#. type: Content of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:803
#, no-wrap
msgid ""
"# <i>freshclam</i>\n"
"ClamAV update process started at Sun May  2 09:13:41 2004\n"
"Reading CVD header (main.cvd): OK\n"
"Downloading main.cvd [*]\n"
"main.cvd updated (version: 22, sigs: 20229, f-level: 1, builder: tkojm)\n"
"Reading CVD header (daily.cvd): OK\n"
"Downloading daily.cvd [*]\n"
"daily.cvd updated (version: 298, sigs: 1141, f-level: 2, builder: diego)\n"
"Database updated (21370 signatures) from database.clamav.net (193.1.219.100).\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:815
#, no-wrap
msgid ""
"Now you have updated virus definitions and you know that\n"
"<path>freshclam.conf</path> is working properly.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:820
#, no-wrap
msgid ""
"Test freshclam and amavisd from the cli and amavisd testmails.\n"
"Start <c>clamd</c> and <c>amavis</c> with the following commands:\n"
msgstr ""

#. type: Attribute 'caption' of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:824
#, no-wrap
msgid "Start amavisd and clamd and reload postfix configuration"
msgstr ""

#. type: Content of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:825
#, no-wrap
msgid ""
"# <i>/etc/init.d/clamd start</i>\n"
"# <i>/etc/init.d/amavisd start</i>\n"
"# <i>/etc/init.d/postfix reload</i>\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:831
#, no-wrap
msgid ""
"If everything went well <c>postfix</c> should now be listening for mails on port\n"
"25 and for reinjected mails on port 10024. To verify this check your log file.\n"
msgstr ""

#. type: Attribute 'caption' of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:835
#, no-wrap
msgid "Checking log files"
msgstr ""

#. type: Content of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:836
#, no-wrap
msgid "# <i>tail -f /var/log/mail.log</i>\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><note>
#: en/mailfilter-guide.xml:840
#, no-wrap
msgid ""
"Depending on your log settings the correct path might be\n"
"<path>/var/log/messages</path>.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:845
#, no-wrap
msgid ""
"Now if no strange messages appear in the log file it is time for a new\n"
"test.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:850
#, no-wrap
msgid ""
"Use <c>netcat</c> to manually connect to <c>amavisd</c> on port 10024\n"
"and <c>postfix</c> on port 10025.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><note>
#: en/mailfilter-guide.xml:855
#, no-wrap
msgid ""
"Netcat can be used as an advanced replacement for <c>telnet</c>. Install it with\n"
"<c>emerge netcat</c>.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><note>
#: en/mailfilter-guide.xml:860
#, no-wrap
msgid ""
"For some unknown reason you can not complete a manual mail injection to\n"
"<c>amavisd</c> with netcat. Use <c>telnet</c> instead.\n"
msgstr ""

#. type: Attribute 'caption' of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:864
#, no-wrap
msgid "Manually checking that amavisd and postfix are listning to the new ports"
msgstr ""

#. type: Content of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:865
#, no-wrap
msgid ""
"# <i>nc localhost 10024</i>\n"
"<comment>(Amavis working)</comment>\n"
"220 [127.0.0.1] ESMTP amavisd-new service ready\n"
"<i>nc localhost 10025</i>\n"
"<comment>(Postfix reinject working)</comment>\n"
"220 example.com ESMTP Postfix\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><note>
#: en/mailfilter-guide.xml:874
#, no-wrap
msgid ""
"If you want to see the complete output from amavisd-new start\n"
"<c>amavisd debug-sa</c> as the <c>amavis</c> user and send a mail.\n"
"For this to work you might have to change the default shell in\n"
"<path>/etc/passwd</path>.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:881
#, no-wrap
msgid "Add <c>amavisd</c> and <c>clamd</c> to the <c>default</c> runlevel.\n"
msgstr ""

#. type: Attribute 'caption' of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:884
#, no-wrap
msgid "Add amavisd and clamd to the default runlevel"
msgstr ""

#. type: Content of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:885
#, no-wrap
msgid ""
"# <i>rc-update add clamd default</i>\n"
"# <i>rc-update add amavisd default</i>\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><note>
#: en/mailfilter-guide.xml:890
#, no-wrap
msgid ""
"We do not add <c>spamd</c> to the default runlevel as <c>amavisd</c>\n"
"uses the Spamassassin Perl libraries directly.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><note>
#: en/mailfilter-guide.xml:895
#, no-wrap
msgid ""
"You might notice <c>Net::Server: Couldn't POSIX::setuid to ...\n"
"[]</c> lines in your log. According to\n"
"<uri link=\"http://www.ijs.si/software/amavisd/README.chroot\">amavis chroot\n"
"README</uri>, if the process UID remains 0 (<c>root</c>), the program will\n"
"terminate, otherwise you can consider the message just as informative.\n"
"This is because <c>POSIX::setuid()</c> returns a string <c>0 but\n"
"true</c>.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><impo>
#: en/mailfilter-guide.xml:905
#, no-wrap
msgid ""
"If you enabled login for amavis remember to set back the login shell in\n"
"<path>/etc/passwd</path> to <c>/bin/false</c>.\n"
msgstr ""

#. type: Content of: <guide><chapter><title>
#: en/mailfilter-guide.xml:914
#, no-wrap
msgid "Autolearning and sidelining emails"
msgstr ""

#. type: Content of: <guide><chapter><section><title>
#: en/mailfilter-guide.xml:916
#, no-wrap
msgid "Creating the spamtrap user"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:920
#, no-wrap
msgid "Create the spamtrap account and directories.\n"
msgstr ""

#. type: Attribute 'caption' of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:923
#, no-wrap
msgid "Create spamtrap account"
msgstr ""

#. type: Content of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:924
#, no-wrap
msgid ""
"# <i>useradd -m spamtrap</i>\n"
"# <i>maildirmake /home/spamtrap/.maildir</i>\n"
"# <i>chown -R spamtrap:spamtrap /home/spamtrap/.maildir</i>\n"
"<comment>(Give the spamtrap user a sensible password)</comment>\n"
"# <i>passwd spamtrap</i>\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:932
#, no-wrap
msgid ""
"If you manually want to check some of the mails to ensure that you have no false\n"
"positives you can use the following <c>procmail</c> recipe to sideline spam\n"
"found into different mail folders.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><title>
#: en/mailfilter-guide.xml:940
#, no-wrap
msgid "Creating .procmailrc"
msgstr ""

#. type: Attribute 'caption' of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:943
#, no-wrap
msgid "Creating /home/spamtrap/.procmailrc"
msgstr ""

#. type: Content of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:944
#, no-wrap
msgid ""
"<comment>#Set some default variables</comment>\n"
"MAILDIR=$HOME/.maildir\n"
"\n"
"SPAM_FOLDER=$MAILDIR/.spam-found/\n"
"\n"
"LIKELY_SPAM_FOLDER=$MAILDIR/.likely-spam-found/\n"
"\n"
"<comment>#Sort mails with a spamscore of 7+ to the spamfolder</comment>\n"
":0:\n"
"* ^X-Spam-Status: Yes\n"
"* ^X-Spam-Level: \\*\\*\\*\\*\\*\\*\\*\n"
"$SPAM_FOLDER\n"
"\n"
"<comment>#Sort mail with a spamscore between 5-7 to the likely spam folder</comment>\n"
":0:\n"
"* ^X-Spam-Status: Yes\n"
"$LIKELY_SPAM_FOLDER\n"
"\n"
"<comment>#Sort all other mails to the inbox</comment>\n"
":0\n"
"*\n"
"./\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><warn>
#: en/mailfilter-guide.xml:969
#, no-wrap
msgid ""
"If your mail server is going to receive a lot of mail you should NOT\n"
"use the likely-spam recipe. Instead set <c>$sa_tag2_level_deflt</c>\n"
"high enough to avoid false positives and filter it directly to\n"
"<c>$SPAM_FOLDER</c>.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><note>
#: en/mailfilter-guide.xml:976
#, no-wrap
msgid ""
"If you haven't already installed <c>procmail</c> do it with <c>emerge\n"
"procmail</c>.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:981
#, no-wrap
msgid "Now make sure that Postfix uses <c>procmail</c> to deliver mail.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:985
#, no-wrap
msgid "mailbox_command = /usr/bin/procmail -a \"DOMAIN\"\n"
msgstr ""

#. type: Content of: <guide><chapter><section><title>
#: en/mailfilter-guide.xml:991
#, no-wrap
msgid "Create mailfolders"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:995
#, no-wrap
msgid "Now we will create shared folders for ham and spam.\n"
msgstr ""

#. type: Attribute 'caption' of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:998
#, no-wrap
msgid "Create the necessary mailfolders"
msgstr ""

#. type: Content of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:999
#, no-wrap
msgid ""
"# <i>maildirmake /var/amavis/.maildir</i>\n"
"# <i>maildirmake -S /var/amavis/.maildir/Bayes</i>\n"
"# <i>maildirmake -s write -f spam /var/amavis/.maildir/Bayes</i>\n"
"# <i>maildirmake -s write -f ham /var/amavis/.maildir/Bayes</i>\n"
"# <i>maildirmake -s write -f redeliver /var/amavis/.maildir/Bayes</i>\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:1007
#, no-wrap
msgid ""
"Amavisd-new needs to be able to read these files as well as all mailusers.\n"
"Therefore we add all the relevant users to the mailuser group along with amavis.\n"
msgstr ""

#. type: Attribute 'caption' of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:1011
#, no-wrap
msgid "Setting the proper permissions"
msgstr ""

#. type: Content of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:1012
#, no-wrap
msgid ""
"# <i>groupadd mailusers</i>\n"
"# <i>usermod -G mailusers spamtrap</i>\n"
"# <i>chown -R amavis:mailusers /var/amavis/.maildir/</i>\n"
"# <i>chown amavis:mailusers /var/amavis/</i>\n"
"# <i>chmod -R 1733 /var/amavis/.maildir/Bayes/</i>\n"
"# <i>chmod g+rx /var/amavis/.maildir/</i>\n"
"# <i>chmod g+rx /var/amavis/.maildir/Bayes/</i>\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><warn>
#: en/mailfilter-guide.xml:1022
#, no-wrap
msgid ""
"This grants members of the <c>mailusers</c> groups access to <c>amavis</c>\n"
"mail.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:1027
#, no-wrap
msgid ""
"This makes the spam and ham folders writable but not readable. This way\n"
"users can safely submit their ham without anyone else being able to read it.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:1032
#, no-wrap
msgid "Then run the following command as the <c>spamtrap</c> user:\n"
msgstr ""

#. type: Attribute 'caption' of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:1035
#, no-wrap
msgid "Adding the shared folders to the users mailfolder"
msgstr ""

#. type: Content of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:1036
#, no-wrap
msgid "$ <i>maildirmake --add Bayes=/var/amavis/.maildir/Bayes $HOME/.maildir</i>\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><note>
#: en/mailfilter-guide.xml:1040
#, no-wrap
msgid ""
"We have to give the group read permissions on the <path>Bayes</path>\n"
"folder in order for the mail client to be able to see the subdirectories used by\n"
"IMAP.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><title>
#: en/mailfilter-guide.xml:1048
#, no-wrap
msgid "Adding cron jobs"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:1052
#, no-wrap
msgid ""
"Now run <c>crontab -u amavis -e</c> to edit the amavis crontab to\n"
"enable automatic learning of the Bayes filter every hour.\n"
msgstr ""

#. type: Attribute 'caption' of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:1056
#, no-wrap
msgid "amavis crontab"
msgstr ""

#. type: Content of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:1057
#, no-wrap
msgid ""
"<comment>#Auto learn</comment>\n"
"0 * * * *          /usr/bin/sa-learn --spam /var/amavis/.maildir/Bayes/.spam/{cur,new} \\\n"
"                    > /dev/null 2>&amp;1\n"
"0 * * * *          /usr/bin/sa-learn --ham /var/amavis/.maildir/Bayes/.ham/{cur,new} > \\\n"
"                   /dev/null 2>&amp;1\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><note>
#: en/mailfilter-guide.xml:1065
#, no-wrap
msgid ""
"<c>amavis</c> has to be a member of the <c>cron</c> group to run\n"
"crons.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><note>
#: en/mailfilter-guide.xml:1070
#, no-wrap
msgid ""
"It seems like the shared maildir folders will make <c>sa-learn</c> examine all\n"
"messages twice. This should not be a problem. The output will also show that the\n"
"maximum of messages learned from is half or less than the messages examined.\n"
msgstr ""

#. type: Attribute 'caption' of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:1078 en/mailfilter-guide.xml:1695
#, no-wrap
msgid "Modifying amavisd.conf"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:1082
#, no-wrap
msgid ""
"Now modify amavis to redirect spam emails to the <c>spamtrap</c> account and\n"
"keep spamheaders.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:1087
#, no-wrap
msgid ""
"<comment>(Define the account to send virus spam emails)</comment>\n"
"$spam_quarantine_to = \"spamtrap\\@$myhostname\";\n"
msgstr ""

#. type: Content of: <guide><chapter><section><title>
#: en/mailfilter-guide.xml:1094
#, no-wrap
msgid "Cleaning up"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:1098
#, no-wrap
msgid ""
"We don't want to keep mail forever so we use <c>tmpwatch</c> to clean up\n"
"regularily. Emerge it with <c>emerge tmpwatch</c>.  Only <c>root</c> is able to\n"
"run <c>tmpwatch</c> so we have to edit the <c>root</c> crontab.\n"
msgstr ""

#. type: Attribute 'caption' of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:1103
#, no-wrap
msgid "Modifying root crontab"
msgstr ""

#. type: Content of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:1104
#, no-wrap
msgid ""
"<comment># Clean up\n"
"# Keep virusmails for a week (24*7 hours)</comment>\n"
"15 0 * * *      /usr/sbin/tmpwatch -c -f -d --quiet 168 /var/amavis/virusmails/\n"
"<comment># Delete spam and ham learned after a week</comment>\n"
"15 0 * * *      /usr/sbin/tmpwatch -c -f -d --quiet 168 /var/amavis/.maildir/Bayes/\n"
msgstr ""

#. type: Content of: <guide><chapter><title>
#: en/mailfilter-guide.xml:1184
#, no-wrap
msgid "Greylisting"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:1190
#, no-wrap
msgid ""
"Greylisting is one of the newer weapons in the spam fighting\n"
"arsenal. As the name implies it is much like whitelisting and\n"
"blacklisting. Each time an unknown mailserver tries to deliver\n"
"mail the mail is rejected with a <e>try again later</e> message.\n"
"This means that mail gets delayed but also that stupid spam bots\n"
"that do not implement the RFC protocol will drop the attempt to\n"
"deliver the spam and never retry.  With time spam bots will probably\n"
"adjust, however it will give other technologies more time to identify\n"
"the spam.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><note>
#: en/mailfilter-guide.xml:1202
#, no-wrap
msgid ""
"If your ISP blocks incoming traffic on port 25 and relays all mail to you\n"
"through their own mail server greylisting will not work.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:1207
#, no-wrap
msgid ""
"Postfix 2.1 come with a simple Perl greylisting policy server that\n"
"implements such a scheme. However it suffers from unpredictable\n"
"results when the partition holding the greylisting database run\n"
"out of space. There exists an improved version that do not suffer\n"
"this problem. First I will show how to install the builtin\n"
"greylisting support that come with Postfix and then I will show\n"
"how to configure the more robust replacement.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><note>
#: en/mailfilter-guide.xml:1217
#, no-wrap
msgid ""
"There are other greylisting policy servers for Postfix around (such as <uri\n"
"link=\"http://www.gasmi.net/gld.html\">Gld</uri>, which is in Portage, and <uri\n"
"link=\"http://sqlgrey.sourceforge.net/\">SQLgrey</uri>). Some of them support\n"
"database backends, auto whitelisting and other neat features.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><title>
#: en/mailfilter-guide.xml:1226
#, no-wrap
msgid "Simple greylisting"
msgstr ""

#. type: Content of: <guide><chapter><section><body><note>
#: en/mailfilter-guide.xml:1230
#, no-wrap
msgid ""
"If you prefer to use the improved greylisting with postgrey you can\n"
"safely skip this section.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:1235
#, no-wrap
msgid ""
"We need the file <path>greylist.pl</path> but unfortunately\n"
"the ebuild does not install it as default.\n"
msgstr ""

#. type: Attribute 'caption' of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:1239
#, no-wrap
msgid "Getting greylist.pl"
msgstr ""

#. type: Content of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:1240
#, no-wrap
msgid ""
"# <i>cp /usr/portage/distfiles/postfix-your-version-here.tar.gz /root/</i>\n"
"# <i>tar xzf postfix-your-version-here.tar.gz</i>\n"
"# <i>cp postfix-2.1.0/examples/smtpd-policy/greylist.pl /usr/bin/</i>\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:1246
#, no-wrap
msgid ""
"Now we have the file in place we need to create the directory\n"
"to hold the greylisting database:\n"
msgstr ""

#. type: Attribute 'caption' of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:1250
#, no-wrap
msgid "Creating directory for the greylisting database"
msgstr ""

#. type: Content of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:1251
#, no-wrap
msgid ""
"# <i>mkdir /var/mta</i>\n"
"# <i>chown nobody /var/mta</i>\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><warn>
#: en/mailfilter-guide.xml:1256
#, no-wrap
msgid ""
"Do not create the greylisting database directory on a partition that\n"
"might run out of space. While postfix can recover from no-space-left\n"
"situations for the mail queue and mail box situations, this is not the\n"
"case with the greylisting database. If the file becomes corrupted\n"
"you may not be able to receive mail at all until you delete the file\n"
"by hand.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><title>
#: en/mailfilter-guide.xml:1267
#, no-wrap
msgid "Configuring greylisting"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:1271
#, no-wrap
msgid ""
"Now that we have all this ready all that is left is to add it to the\n"
"postfix configuration. First we add the necessary information to the\n"
"<path>master.cf</path>:\n"
msgstr ""

#. type: Attribute 'caption' of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:1276
#, no-wrap
msgid "Modifying master.cf to use greylisting"
msgstr ""

#. type: Content of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:1277
#, no-wrap
msgid ""
"policy-greylist  unix  -       n       n       -       -       spawn\n"
"   user=nobody argv=/usr/bin/perl /usr/bin/greylist.pl\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:1282
#, no-wrap
msgid ""
"The postfix spawn daemon normally kills its child processes after 1000\n"
"seconds but this is too short for the greylisting process so we have\n"
"to increase the timelimit in <path>main.cf</path>:\n"
msgstr ""

#. type: Attribute 'caption' of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:1287 en/mailfilter-guide.xml:1371
#, no-wrap
msgid "Modifying main.cf to use greylisting"
msgstr ""

#. type: Content of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:1288
#, no-wrap
msgid ""
"policy-greylist_time_limit = 3600\n"
"<comment>(Under smtpd_recipient_restrictions add:)</comment>\n"
"check_sender_access hash:/etc/postfix/sender_access\n"
"<comment>(Later on add:)</comment>\n"
"restriction_classes = greylist\n"
"greylist = check_policy_service unix:private/policy-greylist\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><warn>
#: en/mailfilter-guide.xml:1297
#, no-wrap
msgid ""
"Be sure to specify <c>check_sender_access</c> AFTER\n"
"<c>reject_unauth_destination</c> or else your system could become an\n"
"open mail relay.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><note>
#: en/mailfilter-guide.xml:1303
#, no-wrap
msgid ""
"The greylist database gets polluted quickly with bogus addresses. It\n"
"helps if you protect greylist lookups with other restrictions that\n"
"reject unknown senders and/or recipients.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:1309
#, no-wrap
msgid ""
"We don't want to use greylisting for all domains but only for those\n"
"frequently abused by spammers. After all it will delay mail delivery.\n"
"A list of frequently forged MAIL FROM domains can be found <uri\n"
"link=\"http://www.monkeys.com/anti-spam/filtering/sender-domain-validate.in\">online</uri>.\n"
"Add the domains you receive a lot of spam from to\n"
"<path>/etc/postfix/sender_access</path>:\n"
msgstr ""

#. type: Attribute 'caption' of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:1317
#, no-wrap
msgid "Format of sender_access"
msgstr ""

#. type: Content of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:1318
#, no-wrap
msgid ""
"aol.com     greylist\n"
"hotmail.com greylist\n"
"bigfoot.com greylist\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:1324
#, no-wrap
msgid "If you want a more extensive list:\n"
msgstr ""

#. type: Attribute 'caption' of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:1327
#, no-wrap
msgid "Adding all domains to sender_access"
msgstr ""

#. type: Content of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:1328
#, no-wrap
msgid ""
"# <i>wget http://www.monkeys.com/anti-spam/filtering/sender-domain-validate.in</i>\n"
"# <i>cat sender-domain-validate.in | sort | awk {'print $1 \"\\t\\t greylist\"'} > /etc/postfix/sender_access</i>\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:1333
#, no-wrap
msgid ""
"Now we only have to initialize the <path>sender_access</path>\n"
"database:\n"
msgstr ""

#. type: Attribute 'caption' of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:1337
#, no-wrap
msgid "Initialize sender_access"
msgstr ""

#. type: Content of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:1338
#, no-wrap
msgid "# <i>postmap /etc/postfix/sender_access</i>\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:1342
#, no-wrap
msgid "Now the setup of simple greylisting is complete.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><warn>
#: en/mailfilter-guide.xml:1346
#, no-wrap
msgid ""
"I tried this on one box handling thousands of mails daily and the\n"
"results were almost a complete disaster. After four days the box was\n"
"bogged down with hundreds of old <c>greylist.pl</c> processes.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><title>
#: en/mailfilter-guide.xml:1354
#, no-wrap
msgid "Configuring improved greylisting with postgrey"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:1358
#, no-wrap
msgid ""
"You can install the enhanced greylisting policy server with a simple\n"
"<c>emerge</c>:\n"
msgstr ""

#. type: Attribute 'caption' of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:1362
#, no-wrap
msgid "Installing postgrey"
msgstr ""

#. type: Content of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:1363
#, no-wrap
msgid "# <i>emerge postgrey</i>\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:1367
#, no-wrap
msgid ""
"After installing <c>postgrey</c> we have to edit <path>main.cf</path>.\n"
"Changes are almost exactly like the built in greylisting.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:1372
#, no-wrap
msgid ""
"<comment>(Under smtpd_recipient_restrictions add:)</comment>\n"
"check_sender_access hash:/etc/postfix/sender_access\n"
"<comment>(Later on add:)</comment>\n"
"smtpd_restriction_classes = greylist\n"
"greylist = check_policy_service inet:127.0.0.1:10030\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><note>
#: en/mailfilter-guide.xml:1380
#, no-wrap
msgid ""
"The Postfix SMTPD_POLICY_README only uses <c>restriction_classes</c>\n"
"but that does not appear to work.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><note>
#: en/mailfilter-guide.xml:1385
#, no-wrap
msgid ""
"If you want to greylist everything instead add <c>check_policy_service\n"
"inet:127.0.0.1:10030</c>.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:1390
#, no-wrap
msgid "Finally, start the server and add it to the proper runlevel.\n"
msgstr ""

#. type: Attribute 'caption' of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:1393
#, no-wrap
msgid "Starting postgrey"
msgstr ""

#. type: Content of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:1394
#, no-wrap
msgid ""
"# <i>/etc/init.d/postgrey start</i>\n"
"# <i>rc-update add postgrey default</i>\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><note>
#: en/mailfilter-guide.xml:1399
#, no-wrap
msgid ""
"Some people like to get their mail fast and thus greylisting is\n"
"worthless. However if you employ a backup mail server you can safely\n"
"setup greylisting on that server. My limited experiences tell me that\n"
"it can stop up to a third of the spam received.\n"
msgstr ""

#. type: Content of: <guide><chapter><title>
#: en/mailfilter-guide.xml:1409
#, no-wrap
msgid "SPF (Sender Policy Framework)"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:1415
#, no-wrap
msgid ""
"SPF allows domain owners to state in their DNS records which IP\n"
"addressess should be allowed to send mails from their domain. This\n"
"will prevent spammers from spoofing the <c>Return-Path</c>.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><note>
#: en/mailfilter-guide.xml:1421
#, no-wrap
msgid ""
"If your ISP blocks incoming traffic on port 25 and relays all mail to you\n"
"through their own mail server SPF will not work.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:1426
#, no-wrap
msgid ""
"First domain owners have to create a special <c>TXT</c> DNS record.\n"
"Then an SPF-enabled MTA can read this and if the mail originates from a\n"
"server that is not described in the SPF record the mail can be\n"
"rejected. An example entry could look like this:\n"
msgstr ""

#. type: Attribute 'caption' of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:1432
#, no-wrap
msgid "Example SPF record"
msgstr ""

#. type: Content of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:1433
#, no-wrap
msgid "example.com.  IN TXT  \"v=spf1 a mx ptr -all\"\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:1437
#, no-wrap
msgid ""
"The <c>-all</c> means to reject all mail by default but allow mail\n"
"from the <c>A</c>(<c>a</c>), <c>MX</c>(<c>mx</c>) and\n"
"<c>PTR</c>(<c>ptr</c>) DNS records. For more info consult further\n"
"resources below.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><note>
#: en/mailfilter-guide.xml:1444
#, no-wrap
msgid ""
"If you relay outgoing mail through your ISP you will have to add:\n"
"<c>include:yourisp.com</c>.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:1449
#, no-wrap
msgid ""
"Spamassassin 3.0 has support for SPF, however it is not enabled by default\n"
"and the new policy daemon in Postfix supports SPF so let's install SPF support\n"
"for Postfix.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><note>
#: en/mailfilter-guide.xml:1455
#, no-wrap
msgid ""
"If you want to use SPF with Spamassassin instead simply\n"
"<c>emerge&nbsp;dev-perl/Mail-SPF-Query</c> and restart Amavisd-new.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:1466
#, no-wrap
msgid ""
"First you have to\n"
"install Postfix 2.1 as described above. When you have fetched the\n"
"source grab the <path>spf.pl</path> with:\n"
msgstr ""

#. type: Attribute 'caption' of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:1471
#, no-wrap
msgid "Installing spf.pl"
msgstr ""

#. type: Content of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:1472
#, no-wrap
msgid "# <i>cp postfix-&lt;version&gt;/examples/smtpd-policy/spf.pl /usr/local/bin/</i>\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><note>
#: en/mailfilter-guide.xml:1476
#, no-wrap
msgid ""
"The <path>spf.pl</path> coming with Postfix is slightly buggy so find\n"
"and uncomment the following line: <c>push @HANDLERS, \"sender_permitted_from\";\n"
"use Mail::SPF::Query;</c>. Furthermore in about line 199 substitute\n"
"<c>comemnt</c> with <c>comment</c>. Alternatively you can download a\n"
"<uri link=\"http://spf.pobox.com/postfix-policyd.txt\">development\n"
"version</uri>.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:1485
#, no-wrap
msgid ""
"This Perl script also needs some Perl libraries that are not in\n"
"portage but it is still quite simple to install them:\n"
msgstr ""

#. type: Attribute 'caption' of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:1489
#, no-wrap
msgid "Installing the needed Perl libraries"
msgstr ""

#. type: Content of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:1490
#, no-wrap
msgid "# <i>emerge Mail-SPF-Query Net-CIDR-Lite Sys-Hostname-Long</i>\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:1494
#, no-wrap
msgid ""
"Now that we have everything in place all we need is to configure\n"
"Postfix to use this new policy.\n"
msgstr ""

#. type: Attribute 'caption' of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:1498
#, no-wrap
msgid "Modifying master.cf to use SPF"
msgstr ""

#. type: Content of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:1499
#, no-wrap
msgid ""
"policy-spf  unix  -       n       n       -       -       spawn\n"
"   user=nobody argv=/usr/bin/perl /usr/local/bin/spf.pl\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:1504
#, no-wrap
msgid ""
"Now add the SPF check in <path>main.cf</path>. Properly configured SPF\n"
"should do no harm so we could check SPF for all domains:\n"
msgstr ""

#. type: Attribute 'caption' of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:1508
#, no-wrap
msgid "Modifying main.cf to use SPF"
msgstr ""

#. type: Content of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:1509
#, no-wrap
msgid ""
"<comment>(Under smtpd_recipient_restrictions add:)</comment>\n"
"check_policy_service unix:private/policy-spf\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><note>
#: en/mailfilter-guide.xml:1514
#, no-wrap
msgid ""
"If you're experiencing problems with SPF, e.g. when using\n"
"<c>fetchmail</c>, you might want to enable SPF for certain domains only.\n"
msgstr ""

#. type: Content of: <guide><chapter><title>
#: en/mailfilter-guide.xml:1523
#, no-wrap
msgid "Configuring amavisd-new to use MySQL"
msgstr ""

#. type: Content of: <guide><chapter><section><title>
#: en/mailfilter-guide.xml:1525
#, no-wrap
msgid "Configuring MySQL"
msgstr ""

#. type: Content of: <guide><chapter><section><body><note>
#: en/mailfilter-guide.xml:1529
#, no-wrap
msgid "This has not been tested on versions higher than 2.2. Feedback is welcome :)\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:1533
#, no-wrap
msgid ""
"For large domains the default values you can set in\n"
"<path>amavisd.conf</path> might not suit all users. If you configure\n"
"amavisd-new with MySQL support you can have individual settings for\n"
"users or groups of users.\n"
msgstr ""

#. type: Attribute 'caption' of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:1539
#, no-wrap
msgid "Creating the MySQL database and user"
msgstr ""

#. type: Content of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:1540
#, no-wrap
msgid ""
"# <i>mysql -u root -p mysql</i>\n"
"Enter password:\n"
"Welcome to the MySQL monitor.  Commands end with ; or \\g.\n"
"Your MySQL connection id is 78 to server version: 4.0.18-log\n"
"\n"
"Type 'help;' or '\\h' for help. Type '\\c' to clear the buffer.\n"
"mysql> <i>create database maildb;</i>\n"
"mysql> <i>GRANT INSERT,UPDATE,DELETE,SELECT ON maildb.* TO 'mail'@'localhost' IDENTIFIED BY 'very_secret_password';</i>\n"
"mysql> <i>use maildb;</i>\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:1552
#, no-wrap
msgid ""
"Now that the database is created we'll need to create the necessary tables.\n"
"You can cut and paste the following into the mysql prompt:\n"
msgstr ""

#. type: Attribute 'caption' of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:1556 en/mailfilter-guide.xml:1749
#, no-wrap
msgid "MySQL table layout"
msgstr ""

#. type: Content of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:1557
#, no-wrap
msgid ""
"CREATE TABLE users (\n"
"    id         int unsigned NOT NULL auto_increment,\n"
"    priority   int          NOT NULL DEFAULT '7',  -- 0 is low priority\n"
"    policy_id  int unsigned NOT NULL DEFAULT '1',\n"
"    email      varchar(255) NOT NULL,\n"
"    fullname   varchar(255) DEFAULT NULL,    -- not used by amavisd-new\n"
"    local      char(1),     -- Y/N  (optional field, see note further down)\n"
"    PRIMARY KEY (id),\n"
"    KEY email (email)\n"
"    );\n"
"CREATE UNIQUE INDEX users_idx_email ON users(email);\n"
"\n"
"<comment>(any e-mail address, external or local, used as senders in wblist)</comment>\n"
"CREATE TABLE mailaddr (\n"
"   id         int unsigned NOT NULL auto_increment,\n"
"   priority   int          NOT NULL DEFAULT '7',  -- 0 is low priority\n"
"   email      varchar(255) NOT NULL,\n"
"   PRIMARY KEY (id),\n"
"   KEY email (email)\n"
"   );\n"
"CREATE UNIQUE INDEX mailaddr_idx_email ON mailaddr(email);\n"
"\n"
"<comment>(-- per-recipient whitelist and/or blacklist,</comment>\n"
"<comment>-- puts sender and recipient in relation wb)</comment>\n"
"(white or blacklisted sender)\n"
"CREATE TABLE wblist (\n"
"   rid        int unsigned NOT NULL,     -- recipient: users.id\n"
"   sid        int unsigned NOT NULL,     -- sender:    mailaddr.id\n"
"   wb         char(1) NOT NULL, -- W or Y / B or N / space=neutral\n"
"   PRIMARY KEY (rid,sid)\n"
"   );\n"
"\n"
"CREATE TABLE policy (\n"
"   id               int unsigned NOT NULL auto_increment,\n"
"   policy_name      varchar(32),     -- not used by amavisd-new\n"
"   virus_lover          char(1),     -- Y/N\n"
"   spam_lover           char(1),     -- Y/N  (optional field)\n"
"   banned_files_lover   char(1),     -- Y/N  (optional field)\n"
"   bad_header_lover     char(1),     -- Y/N  (optional field)\n"
"   bypass_virus_checks  char(1),     -- Y/N\n"
"   bypass_spam_checks   char(1),     -- Y/N\n"
"   bypass_banned_checks char(1),     -- Y/N  (optional field)\n"
"   bypass_header_checks char(1),     -- Y/N (optional field)\n"
"   spam_modifies_subj   char(1),     -- Y/N (optional field)\n"
"   spam_quarantine_to   varchar(64) DEFAULT NULL, -- (optional field)\n"
"   spam_tag_level  float,  -- higher score inserts spam info headers\n"
"   spam_tag2_level float DEFAULT NULL,  -- higher score inserts\n"
"               -- 'declared spam' info header fields\n"
"   spam_kill_level float,  -- higher score activates evasive actions, e.g.\n"
"               -- reject/drop, quarantine, ...\n"
"               -- (subject to final_spam_destiny setting)\n"
"   PRIMARY KEY (id)\n"
"  );\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><note>
#: en/mailfilter-guide.xml:1613
#, no-wrap
msgid ""
"If you have problems using copy/paste you might have to copy this\n"
"somewhere else and clean out the unneeded characters.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><note>
#: en/mailfilter-guide.xml:1618
#, no-wrap
msgid ""
"Lookups trying to match email are done with raw (rfc2821-unquoted\n"
"and unbracketed) addresses as a key, i.e.:\n"
"<c>John \"Funny\" Smith@example.com</c>\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><note>
#: en/mailfilter-guide.xml:1624
#, no-wrap
msgid ""
"Lookups are performed in the following order: <c>SQL</c>, <c>LDAP</c>,\n"
"<c>hash</c>, <c>ACL</c>, <c>regexp</c>, <c>constant</c>. The first that\n"
"returns a definitive answer (not <c>undef/NULL</c>) stops the search.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:1630
#, no-wrap
msgid ""
"If you wish to use whitelisting and blacklisting you must add the\n"
"sender and receiver to <c>mailadr</c> after which you create the relation\n"
"between the two e-mail addresses in <c>wblist</c> and state if it is\n"
"whitelisting (<c>W</c>) or blacklisting (<c>B</c>).\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:1637
#, no-wrap
msgid ""
"Now that we have created the tables let's insert a test user and a test\n"
"policy:\n"
msgstr ""

#. type: Attribute 'caption' of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:1641
#, no-wrap
msgid "Create test user and test policy"
msgstr ""

#. type: Content of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:1642
#, no-wrap
msgid ""
"INSERT INTO users\n"
"   SET\n"
"      id         =1,\n"
"      priority   =9,\n"
"      policy_id  =1,\n"
"      email      =\"johndoe@example.com\",\n"
"      fullname   =\"John Doe\",\n"
"      local      =\"Y\";\n"
"\n"
"INSERT INTO policy\n"
"   SET\n"
"      id                     =1,\n"
"      policy_name            =\"Test policy 1\",\n"
"      virus_lover            =\"N\",\n"
"      spam_lover             =\"N\",\n"
"      banned_files_lover     =\"N\",\n"
"      bad_header_lover       =\"N\",\n"
"      bypass_virus_checks    =\"N\",\n"
"      bypass_spam_checks     =\"N\",\n"
"      bypass_banned_checks   =\"N\",\n"
"      bypass_header_checks   =\"N\",\n"
"      spam_modifies_subj     =\"N\",\n"
"      spam_quarantine_to     =NULL,\n"
"      spam_tag_level         =-50.0,\n"
"      spam_tag2_level        =7.0,\n"
"      spam_kill_level        =10.0;\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><note>
#: en/mailfilter-guide.xml:1671
#, no-wrap
msgid "Copy this to somewhere else and adjust to suit your own environment.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><note>
#: en/mailfilter-guide.xml:1675
#, no-wrap
msgid ""
"<c>local</c> should be set to <c>Y</c> otherwise the mail will not be\n"
"scanned for spam.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:1680
#, no-wrap
msgid ""
"This inserts a test user and a Test policy. Adjust these examples to\n"
"fit your needs. Further explanation of the configuration names can be\n"
"found in <path>amavisd.conf</path>.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><title>
#: en/mailfilter-guide.xml:1688
#, no-wrap
msgid "Configuring amavisd to use MySQL"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:1692
#, no-wrap
msgid "Now that MySQL is ready we need to tell amavis to use it:\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:1696
#, no-wrap
msgid ""
"@lookup_sql_dsn =\n"
"   ( ['DBI:mysql:maildb:host1', 'mail', 'very_secret_password']  );\n"
"\n"
"<comment>(For clarity uncomment the default)</comment>\n"
"$sql_select_policy = 'SELECT *,users.id FROM users,policy'.\n"
"   ' WHERE (users.policy_id=policy.id) AND (users.email IN (%k))'.\n"
"   ' ORDER BY users.priority DESC';\n"
"\n"
"<comment>(If you want sender white/blacklisting)</comment>\n"
"   $sql_select_white_black_list = 'SELECT wb FROM wblist,mailaddr'.\n"
"     ' WHERE (wblist.rid=?) AND (wblist.sid=mailaddr.id)'.\n"
"     '   AND (mailaddr.email IN (%k))'.\n"
"     ' ORDER BY mailaddr.priority DESC';\n"
msgstr ""

#. type: Content of: <guide><chapter><title>
#: en/mailfilter-guide.xml:1716
#, no-wrap
msgid "Configuring Spamassassin to use MySQL"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:1721
#, no-wrap
msgid ""
"As of Spamassassin 3.0 it is possible to store the Bayes and AWL data in a MySQL\n"
"database. We will use MySQL as the backend as it can generally outperform other\n"
"databases. Also, using MySQL for both sets of data makes system management much\n"
"easier. Here I will show how to easily accomplish this.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:1728
#, no-wrap
msgid ""
"First start out by creating the new MySQL user and then create\n"
"the needed tables.\n"
msgstr ""

#. type: Attribute 'caption' of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:1732
#, no-wrap
msgid "Creating the new MySQL database and user"
msgstr ""

#. type: Content of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:1733
#, no-wrap
msgid ""
"# <i>mysql -u root -p mysql</i>\n"
"Enter password:\n"
"Welcome to the MySQL monitor.  Commands end with ; or \\g.\n"
"Your MySQL connection id is 78 to server version: 4.0.18-log\n"
"\n"
"Type 'help;' or '\\h' for help. Type '\\c' to clear the buffer.\n"
"mysql> <i>create database dbname;</i>\n"
"mysql> <i>GRANT INSERT,UPDATE,DELETE,SELECT ON dbname.* TO 'dbuser'@'localhost' IDENTIFIED BY 'another_very_secret_password';</i>\n"
"mysql> <i>use dbname;</i>\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:1745
#, no-wrap
msgid ""
"Now that the database is created we'll create the necessary tables. You can cut\n"
"and paste the following into the mysql prompt:\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:1750
#, no-wrap
msgid ""
"      CREATE TABLE bayes_expire (\n"
"          id                    int(11)         NOT NULL default '0',\n"
"          runtime               int(11)         NOT NULL default '0',\n"
"          KEY bayes_expire_idx1 (id)\n"
"          ) TYPE=MyISAM;\n"
"\n"
"      CREATE TABLE bayes_global_vars (\n"
"          variable              varchar(30)     NOT NULL default '',\n"
"          value                 varchar(200)    NOT NULL default '',\n"
"          PRIMARY KEY           (variable)\n"
"          ) TYPE=MyISAM;\n"
"\n"
"      INSERT INTO bayes_global_vars VALUES ('VERSION','3');\n"
"\n"
"      CREATE TABLE bayes_seen (\n"
"          id                    int(11)         NOT NULL default '0',\n"
"          msgid                 varchar(200) binary NOT NULL default '',\n"
"          flag                  char(1)         NOT NULL default '',\n"
"          PRIMARY KEY           (id,msgid)\n"
"          ) TYPE=MyISAM;\n"
"\n"
"      CREATE TABLE bayes_token (\n"
"          id                    int(11)         NOT NULL default '0',\n"
"          token                 char(5)         NOT NULL default '',\n"
"          spam_count            int(11)         NOT NULL default '0',\n"
"          ham_count             int(11)         NOT NULL default '0',\n"
"          atime                 int(11)         NOT NULL default '0',\n"
"          PRIMARY KEY           (id, token),\n"
"          INDEX (id, atime)\n"
"          ) TYPE=MyISAM;\n"
"\n"
"      CREATE TABLE bayes_vars (\n"
"          id                    int(11)         NOT NULL AUTO_INCREMENT,\n"
"          username              varchar(200)    NOT NULL default '',\n"
"          spam_count            int(11)         NOT NULL default '0',\n"
"          ham_count             int(11)         NOT NULL default '0',\n"
"          token_count           int(11)         NOT NULL default '0',\n"
"          last_expire           int(11)         NOT NULL default '0',\n"
"          last_atime_delta      int(11)         NOT NULL default '0',\n"
"          last_expire_reduce    int(11)         NOT NULL default '0',\n"
"          oldest_token_age      int(11)         NOT NULL default '2147483647',\n"
"          newest_token_age      int(11)         NOT NULL default '0',\n"
"          PRIMARY KEY           (id),\n"
"          UNIQUE bayes_vars_idx1 (username)\n"
"          ) TYPE=MyISAM;\n"
"\n"
"      CREATE TABLE awl (\n"
"          username              varchar(100)    NOT NULL default '',\n"
"          email                 varchar(200)    NOT NULL default '',\n"
"          ip                    varchar(10)     NOT NULL default '',\n"
"          count                 int(11)         default '0',\n"
"          totscore              float           default '0',\n"
"          PRIMARY KEY           (username,email,ip)\n"
"          ) TYPE=MyISAM;\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><impo>
#: en/mailfilter-guide.xml:1807
#, no-wrap
msgid ""
"The <c>INSERT</c> line is needed otherwise Spamassassin\n"
"will not work.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><note>
#: en/mailfilter-guide.xml:1812
#, no-wrap
msgid ""
"This is also available in the source tarball in the files\n"
"<path>awl_mysql.sql</path> and <path>bayes_mysql.sql</path>.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><title>
#: en/mailfilter-guide.xml:1819
#, no-wrap
msgid "Configuring Spamassassin to use the MySQL backend"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:1823
#, no-wrap
msgid ""
"If you have an old Bayes database in the DBM database and want\n"
"to keep it follow these instructions:\n"
msgstr ""

#. type: Attribute 'caption' of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:1827
#, no-wrap
msgid "Converting Bayes data from a DBM Database"
msgstr ""

#. type: Content of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:1828
#, no-wrap
msgid ""
"<i>su - amavis</i>\n"
"<i>sa-learn --sync</i>\n"
"<i>sa-learn --backup > backup.txt</i>\n"
"<i>sa-learn --restore backup.txt</i>\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><note>
#: en/mailfilter-guide.xml:1835
#, no-wrap
msgid ""
"Note that the last step should only be performed after the MySQL database and\n"
"<path>secrets.cf</path> have been updated.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:1840
#, no-wrap
msgid "Now give Spamassassin the required info:\n"
msgstr ""

#. type: Attribute 'caption' of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:1843
#, no-wrap
msgid "Modifying /etc/mail/spamassassin/secrets.cf"
msgstr ""

#. type: Content of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:1844
#, no-wrap
msgid ""
"<comment>(Tell Spamassassin to use MySQL for bayes data</comment>\n"
"bayes_store_module              Mail::SpamAssassin::BayesStore::SQL\n"
"bayes_sql_dsn                   DBI:mysql:sa_bayes:localhost:3306\n"
"bayes_sql_username              db_name\n"
"bayes_sql_password              another_very_secret_password\n"
"\n"
"<comment>(Tell Spamassassin to use MySQL for AWL data</comment>\n"
"auto_whitelist_factory          Mail::SpamAssassin::SQLBasedAddrList\n"
"user_awl_dsn                    DBI:mysql:sa_bayes:localhost:3306\n"
"user_awl_sql_username           db_name\n"
"user_awl_sql_password           another_very_secret_password\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:1858
#, no-wrap
msgid "Next, change its permissions for proper security:\n"
msgstr ""

#. type: Attribute 'caption' of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:1861
#, no-wrap
msgid "Changing permissions"
msgstr ""

#. type: Content of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:1862
#, no-wrap
msgid "# <i>chmod 400 /etc/mail/spamassassin/secrets.cf</i>\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><note>
#: en/mailfilter-guide.xml:1866
#, no-wrap
msgid ""
"To create a very secret password use <c>emerge\n"
"app-admin/makepasswd</c> and <c>makepasswd -chars=8</c>\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:1871
#, no-wrap
msgid "Now all you have to do is <c>/etc/init.d/amavisd restart</c>.\n"
msgstr ""

#. type: Content of: <guide><chapter><title>
#: en/mailfilter-guide.xml:1879
#, no-wrap
msgid "Troubleshooting"
msgstr ""

#. type: Content of: <guide><chapter><section><title>
#: en/mailfilter-guide.xml:1881
#, no-wrap
msgid "Amavisd-new"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:1885
#, no-wrap
msgid ""
"To troubleshoot Amavisd-new start out by stopping it with <c>/etc/init.d/amavisd\n"
"stop</c> and then start it manually in the foreground with <c>amavisd debug</c>\n"
"and watch it for anomalies in the output.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><title>
#: en/mailfilter-guide.xml:1893
#, no-wrap
msgid "Spamassassin"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:1897
#, no-wrap
msgid ""
"To troubleshoot Spamassassin you can filter an email through it with\n"
"<c>spamassassin -D &lt; mail</c>. To ensure that the headers are intact you can\n"
"move it from another machine with IMAP.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><note>
#: en/mailfilter-guide.xml:1903
#, no-wrap
msgid ""
"If you need to troubleshoot you have to enable login for the user\n"
"<c>amavis</c> by changing the login shell in <path>/etc/passwd</path> to\n"
"<path>/bin/bash</path>.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:1909
#, no-wrap
msgid ""
"If you want you can make get the same information and more with Amavisd-new\n"
"using <c>amavisd debug-sa</c>.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><title>
#: en/mailfilter-guide.xml:1916
#, no-wrap
msgid "Repeating tasks after installation"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:1920
#, no-wrap
msgid ""
"Some of the activities mentioned in this guide will need to be repeated after\n"
"upgrades. For instance, the <c>chown -R amavis:mailusers</c> in the section on\n"
"<uri link=\"#doc_chap6\">Autolearning and sidelining emails</uri> will need to be\n"
"repeated after every update of amavisd-new.\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:1927
#, no-wrap
msgid ""
"Luckily, Gentoo provides you with the means to perform these steps\n"
"automatically. In <uri\n"
"link=\"/doc/en/handbook/handbook-amd64.xml?part=3&amp;chap=6#doc_chap3\">Hooking in\n"
"the Emerge Process</uri>, the Gentoo Handbook explains how to execute tasks\n"
"after installations of a particular package, like so:\n"
msgstr ""

#. type: Attribute 'caption' of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:1934
#, no-wrap
msgid "Example bashrc snippet for running the mentioned chown"
msgstr ""

#. type: Content of: <guide><chapter><section><body><pre>
#: en/mailfilter-guide.xml:1935
#, no-wrap
msgid ""
"if [ \"${PN}\" == \"amavisd-new\" ] &amp;&amp;\n"
"   [ \"${EBUILD_PHASE}\" == \"postinst\" ]; \n"
"then\n"
"  chown -R amavis:mailusers /var/amavis/.maildir\n"
"fi\n"
msgstr ""

#. type: Content of: <guide><chapter><section><title>
#: en/mailfilter-guide.xml:1945
#, no-wrap
msgid "Getting help"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:1949
#, no-wrap
msgid ""
"If you need help a good place to go is the amavis-user mailing\n"
"list. Before postting a question try searching the <uri\n"
"link=\"http://marc.theaimsgroup.com/?l=amavis-user\">Amavis User\n"
"mailing list archives</uri>. If you find no answer here you can\n"
"subscribe to the <uri\n"
"link=\"https://lists.sourceforge.net/lists/listinfo/amavis-user\">Amavis User\n"
"mailing list</uri>\n"
msgstr ""

#. type: Content of: <guide><chapter><section><body><p>
#: en/mailfilter-guide.xml:1959
#, no-wrap
msgid ""
"If your question is specific to SpamAssassin, DCC, Razor, or\n"
"Postfix, please refer to their respective home pages listed below.\n"
msgstr ""

#. type: Content of: <guide><chapter><title>
#: en/mailfilter-guide.xml:1968
#, no-wrap
msgid "Resources"
msgstr ""

#. type: Content of: <guide><chapter><section><title>
#: en/mailfilter-guide.xml:1970
#, no-wrap
msgid "For further information"
msgstr ""

#. type: Content of: <guide><chapter><section><body><ul><li>
#: en/mailfilter-guide.xml:1975
#, no-wrap
msgid ""
"    <uri link=\"http://www.ijs.si/software/amavisd/INSTALL\">Amavisd-new\n"
"    INSTALL</uri>\n"
"  "
msgstr ""

#. type: Content of: <guide><chapter><section><body><ul><li>
#: en/mailfilter-guide.xml:1979
#, no-wrap
msgid ""
"    <uri link=\"http://www.ijs.si/software/amavisd/README.postfix\">Amavisd-new\n"
"    Postfix README</uri>\n"
"  "
msgstr ""

#. type: Content of: <guide><chapter><section><body><ul><li>
#: en/mailfilter-guide.xml:1983
#, no-wrap
msgid ""
"    <uri link=\"http://www.ijs.si/software/amavisd/amavisd-new-docs.html#pbanks\">Amavisd-new\n"
"    Policy bank documentation</uri>\n"
"  "
msgstr ""

#. type: Content of: <guide><chapter><section><body><ul><li>
#: en/mailfilter-guide.xml:1987
#, no-wrap
msgid ""
"    <uri link=\"http://spamassassin.apache.org/full/3.0.x/dist/sql/README\">Spamassassin\n"
"    SQL README</uri>\n"
"  "
msgstr ""

#. type: Content of: <guide><chapter><section><body><ul><li>
#: en/mailfilter-guide.xml:1991
#, no-wrap
msgid ""
"    <uri link=\"http://www.greylisting.org\">Greylisting</uri>\n"
"  "
msgstr ""

#. type: Content of: <guide><chapter><section><body><ul><li>
#: en/mailfilter-guide.xml:1994
#, no-wrap
msgid ""
"    <uri link=\"http://www.postfix.org/FILTER_README.html\">Postfix\n"
"    SMTPD_POLICY_README</uri>\n"
"  "
msgstr ""

#. type: Content of: <guide><chapter><section><body><ul><li>
#: en/mailfilter-guide.xml:1998
#, no-wrap
msgid ""
"    <uri link=\"http://www.unixwiz.net/techtips/postfix-HELO.html\">Blocking\n"
"    spammers with Postfix HELO controls</uri>\n"
"  "
msgstr ""

#. type: Content of: <guide><chapter><section><body><ul><li>
#: en/mailfilter-guide.xml:2002
#, no-wrap
msgid ""
"    <uri link=\"http://www.linuxjournal.com/article.php?sid=7327\">SPF\n"
"    Overview</uri>\n"
"  "
msgstr ""

#. type: Content of: <guide><chapter><section><body><ul><li>
#: en/mailfilter-guide.xml:2006
#, no-wrap
msgid ""
"    <uri link=\"http://jimsun.linxnet.com/misc/postfix-anti-UCE.txt\">Jim\n"
"    Seymour's Postfix Anti-UCE Cheat Sheet</uri>\n"
"  "
msgstr ""

#. type: Content of: <guide><chapter><section><title>
#: en/mailfilter-guide.xml:2014
#, no-wrap
msgid "General resources"
msgstr ""

#. type: Content of: <guide><chapter><section><body><ul><li>
#: en/mailfilter-guide.xml:2018
#, no-wrap
msgid "<uri link=\"http://www.spamassassin.org\">Spamassassin</uri>"
msgstr ""

#. type: Content of: <guide><chapter><section><body><ul><li>
#: en/mailfilter-guide.xml:2019
#, no-wrap
msgid "<uri link=\"http://www.ijs.si/software/amavisd/\">Amavisd-new</uri>"
msgstr ""

#. type: Content of: <guide><chapter><section><body><ul><li>
#: en/mailfilter-guide.xml:2021
#, no-wrap
msgid ""
"    <uri link=\"http://www.ijs.si/software/amavisd/amavisd-new-docs.html\">Amavisd-new\n"
"    documentation bits and pieces</uri>\n"
"  "
msgstr ""

#. type: Content of: <guide><chapter><section><body><ul><li>
#: en/mailfilter-guide.xml:2024
#, no-wrap
msgid "<uri link=\"http://razor.sourceforge.net/\">Vipuls's Razor</uri>"
msgstr ""

#. type: Content of: <guide><chapter><section><body><ul><li>
#: en/mailfilter-guide.xml:2025
#, no-wrap
msgid "<uri link=\"http://pyzor.sourceforge.net/\">Pyzor</uri>"
msgstr ""

#. type: Content of: <guide><chapter><section><body><ul><li>
#: en/mailfilter-guide.xml:2027
#, no-wrap
msgid ""
"    <uri link=\"http://www.rhyolite.com/anti-spam/dcc/\">Distributed Checksum\n"
"    Clearinghouse</uri>\n"
"  "
msgstr ""

#. type: Content of: <guide><chapter><section><body><ul><li>
#: en/mailfilter-guide.xml:2031
#, no-wrap
msgid ""
"    <uri link=\"http://www.renaissoft.com/projects/maia/\">Maia\n"
"    Mailguard</uri>\n"
"  "
msgstr ""

#. type: Content of: <guide><chapter><section><title>
#: en/mailfilter-guide.xml:2039
#, no-wrap
msgid "Other howtos"
msgstr ""

#. type: Content of: <guide><chapter><section><body><ul><li>
#: en/mailfilter-guide.xml:2044
#, no-wrap
msgid ""
"    <uri link=\"http://www.flakshack.com/anti-spam/\">Fairly-Secure Anti-SPAM\n"
"    Gateway Using OpenBSD, Postfix, Amavisd-new, SpamAssassin, Razor\n"
"    and DCC</uri>\n"
"  "
msgstr ""
